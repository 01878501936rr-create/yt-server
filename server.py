from fastapi import FastAPI
import yt_dlp

app = FastAPI()

@app.get("/")
def root():
    return {"status": "running"}

@app.get("/health")
def health():
    return {"ok": True}

@app.get("/download")
def download(url: str):
    ydl_opts = {
        "quiet": True,
        "skip_download": True,
        "format": "best"
    }

    with yt_dlp.YoutubeDL(ydl_opts) as ydl:
        info = ydl.extract_info(url, download=False)
        formats = []

        for f in info["formats"]:
            if f.get("url"):
                formats.append({
                    "quality": f.get("format_note"),
                    "ext": f.get("ext"),
                    "url": f.get("url")
                })

    return {
        "title": info.get("title"),
        "formats": formats
    }
